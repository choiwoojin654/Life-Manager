<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moa Now - ìƒí™œ ì‹¤ì²œ ì•±</title>
    <style>
        /* [Design System] */
        :root {
            --primary-lime: #D0FF46;
            --bg-gray: #F7F8FA;
            --text-main: #111111;
            --text-sub: #767676;
            --white: #FFFFFF;
            --card-shadow: 0 8px 20px rgba(0,0,0,0.04);
            --danger: #FF5252;
            --modal-bg: rgba(0, 0, 0, 0.6);
            
            /* Score Page Colors */
            --color-sleep: #4e8cff;
            --color-focus: #ff8e3c;
            --color-routine: #9c67ff;
            --color-detox: #2ecc71;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; -webkit-font-smoothing: antialiased; }
        body { background-color: #e5e5e5; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: var(--text-main); }

        /* SVG ì•„ì´ì½˜ */
        .icon-svg { width: 24px; height: 24px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .icon-sm { width: 18px; height: 18px; }

        /* ëª¨ë°”ì¼ í”„ë ˆì„ */
        .mobile-frame {
            width: 375px; height: 812px; background-color: var(--bg-gray); border-radius: 40px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.12); overflow: hidden; position: relative;
            border: 8px solid #1a1a1a; display: flex; flex-direction: column;
        }

        .status-bar { padding: 15px 25px; display: flex; justify-content: space-between; font-size: 14px; font-weight: 600; background: var(--bg-gray); z-index: 10; }
        .content-area { flex: 1; overflow-y: auto; padding: 0 20px 100px; scroll-behavior: smooth; }
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Header & Logo */
        .header-row { display: flex; justify-content: space-between; align-items: center; margin: 10px 0 20px; position: relative; z-index: 2; height: 40px; }
        .logo-container { position: relative; display: inline-block; }
        h1.page-title { font-size: 26px; font-weight: 800; letter-spacing: -0.5px; position: relative; z-index: 2; margin: 0; }
        .blob-line { position: absolute; bottom: 2px; left: 0; width: 100%; height: 8px; background-color: var(--primary-lime); opacity: 0.5; z-index: -1; transform: skewX(-10deg); }
        .deco-blob { position: absolute; background-color: var(--primary-lime); border-radius: 50%; z-index: -1; }
        .blob-1 { width: 30px; height: 30px; top: -8px; right: -12px; opacity: 0.8; }
        
        .noti-btn { cursor: pointer; padding: 5px; position: relative; }
        .noti-dot { position: absolute; top: 5px; right: 5px; width: 8px; height: 8px; background: var(--danger); border-radius: 50%; border: 1px solid var(--bg-gray); }

        /* Sidebar */
        .sidebar-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 150; display: none; opacity: 0; transition: opacity 0.3s; }
        .sidebar-overlay.active { display: block; opacity: 1; }
        .sidebar { position: absolute; top: 0; right: -320px; width: 280px; height: 100%; background: var(--white); z-index: 160; padding: 25px 20px; transition: right 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); display: flex; flex-direction: column; box-shadow: -5px 0 20px rgba(0,0,0,0.1); }
        .sidebar.active { right: 0; }
        .sidebar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-top: 20px; }
        .noti-item { padding: 15px 0; border-bottom: 1px solid #f0f0f0; display: flex; gap: 12px; align-items: flex-start; }
        .noti-icon-box { width: 36px; height: 36px; background: #F0F2F5; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }

        /* Modal Popup Styles */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--modal-bg); z-index: 200;
            display: none; justify-content: center; align-items: center;
            animation: fadeIn 0.2s ease;
        }
        .modal-box {
            background: white; width: 80%; padding: 25px; border-radius: 24px;
            text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transform: scale(0.9); animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes popIn { to { transform: scale(1); } }
        .modal-title { font-size: 18px; font-weight: 700; margin-bottom: 10px; }
        .modal-desc { font-size: 14px; color: #666; margin-bottom: 20px; line-height: 1.4; }
        .modal-btns { display: flex; gap: 10px; justify-content: center; }
        .modal-btn { flex: 1; padding: 12px; border-radius: 14px; border: none; font-weight: 700; cursor: pointer; font-size: 14px; }
        .btn-cancel { background: #f0f0f0; color: #666; }
        .btn-confirm { background: var(--primary-lime); color: var(--text-main); }
        .checkmark-circle { width: 50px; height: 50px; border-radius: 50%; background: var(--primary-lime); display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; }
        .checkmark { color: var(--text-main); font-size: 24px; }

        /* [HOME Styles] */
        .home-score-card { 
            background: var(--white); border-radius: 24px; padding: 25px; margin-bottom: 20px; 
            box-shadow: var(--card-shadow); display: flex; justify-content: space-between; align-items: center; 
            position: relative; overflow: hidden;
        }
        .home-score-text h3 { font-size: 14px; color: var(--text-sub); margin-bottom: 5px; font-weight: 500; }
        .home-score-text .value { font-size: 42px; font-weight: 800; color: var(--text-main); line-height: 1; }
        .score-trend { font-size: 12px; color: #4CAF50; margin-top: 5px; display: flex; align-items: center; gap: 4px; font-weight: 600; }
        .home-chart-container { position: relative; width: 80px; height: 80px; display: flex; justify-content: center; align-items: center; }
        .home-circular-chart { display: block; margin: 0 auto; max-width: 100%; max-height: 100%; transform: rotate(-90deg); }
        .home-circle-bg { fill: none; stroke: #eee; stroke-width: 3.8; }
        .home-circle { 
            fill: none; stroke-width: 3.8; stroke-linecap: round; stroke: var(--primary-lime); 
            stroke-dasharray: 226; stroke-dashoffset: 226; animation: homeProgress 1.5s ease-out forwards; 
        }
        @keyframes homeProgress { to { stroke-dashoffset: 80; } }

        .now-card { background-color: var(--text-main); color: var(--white); border-radius: 24px; padding: 25px; margin-bottom: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.15); }
        .now-badge { background: var(--primary-lime); color: var(--text-main); padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 700; display: inline-block; margin-bottom: 15px; }
        .now-title { font-size: 18px; font-weight: 700; line-height: 1.4; margin-bottom: 20px; }
        .action-btn { background: var(--primary-lime); color: var(--text-main); width: 100%; padding: 14px; border-radius: 14px; border: none; font-weight: 700; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: transform 0.1s; }
        
        .section-title { margin: 30px 0 15px; font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .list-item-card { background: white; padding: 16px 20px; border-radius: 18px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.02); cursor: pointer; transition: transform 0.1s; }
        .list-content { display: flex; align-items: center; gap: 12px; flex: 1; }
        .check-box { width: 24px; height: 24px; border: 2px solid #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; background: white; flex-shrink: 0; }
        .check-icon { display: none; stroke: var(--text-main); stroke-width: 3; }
        .list-item-card.checked-state .check-box { background-color: var(--primary-lime); border-color: var(--primary-lime); }
        .list-item-card.checked-state .check-icon { display: block; }
        .list-item-card.checked-state .content-text { text-decoration: line-through; color: #aaa; }
        .content-text { font-size: 15px; font-weight: 500; transition: color 0.2s; }

        /* [TODO Styles] */
        .calendar-container { background: white; border-radius: 24px; padding: 20px; box-shadow: var(--card-shadow); margin-bottom: 20px; }
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .cal-nav-btn { width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; cursor: pointer; border-radius: 50%; background: #f5f5f5; font-weight: bold; }
        .cal-title { font-size: 16px; font-weight: 700; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .cal-day-name { font-size: 12px; color: #999; margin-bottom: 10px; font-weight: 600; }
        .cal-date { height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-size: 14px; cursor: pointer; position: relative; }
        .cal-date.today { border: 1px solid var(--primary-lime); color: #555; font-weight: 700; }
        .cal-date.selected { background: var(--text-main); color: var(--primary-lime); font-weight: 700; }
        .cal-date.has-todo::after { content: ''; width: 4px; height: 4px; background: var(--danger); border-radius: 50%; position: absolute; bottom: 4px; }
        .cal-date.empty { cursor: default; }

        .date-display-header { font-size: 14px; color: #666; font-weight: 600; margin-bottom: 10px; }
        
        .add-box { background: white; padding: 10px; border-radius: 16px; display: flex; gap: 8px; margin-bottom: 20px; box-shadow: var(--card-shadow); }
        .add-time-input { width: 35%; border: none; background: #f5f5f5; padding: 12px 10px; border-radius: 10px; outline: none; font-size: 13px; font-family: inherit; text-align: center; }
        .add-text-input { flex: 1; border: none; background: #f5f5f5; padding: 12px 10px; border-radius: 10px; outline: none; font-size: 14px; }
        .add-btn { width: 60px; background: var(--primary-lime); border: none; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-main); font-size: 28px; font-weight: 300; }
        
        .schedule-card { background: white; border-radius: 20px; padding: 18px; margin-bottom: 12px; display: flex; align-items: center; box-shadow: var(--card-shadow); border-left: 5px solid transparent; transition: all 0.2s; cursor: pointer; }
        .schedule-card.active-border { border-left-color: var(--primary-lime); }
        .time-col { width: 75px; flex-shrink: 0; display: flex; flex-direction: column; gap: 4px; font-weight: 700; color: #333; font-size: 15px; }
        .time-ampm { font-size: 11px; color: #999; font-weight: 500; }
        .task-col { flex: 1; }
        .task-title { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .task-tag { font-size: 11px; padding: 3px 8px; background: #f0f0f0; border-radius: 6px; color: #666; display: inline-block; }
        .schedule-check-circle { width: 24px; height: 24px; border: 2px solid #ddd; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .schedule-card.done .schedule-check-circle { background: var(--primary-lime); border-color: var(--primary-lime); }
        .schedule-card.done .schedule-check-circle svg { opacity: 1; color: white; }
        .schedule-card.done .task-title { text-decoration: line-through; color: #aaa; }
        .delete-btn-sm { padding: 5px; color: #ff5252; opacity: 0.5; margin-left: 8px; }

        /* [ROUTINE Styles] */
        .routine-week-tracker { background: white; border-radius: 20px; padding: 15px; margin-bottom: 20px; box-shadow: var(--card-shadow); display: flex; justify-content: space-between; }
        .week-day-col { display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer; width: 40px; }
        .wd-name { font-size: 11px; color: #999; }
        .wd-circle { width: 32px; height: 32px; border-radius: 50%; background: #f5f5f5; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; transition: all 0.2s; }
        .wd-circle.filled { background: var(--primary-lime); color: var(--text-main); border: 2px solid var(--primary-lime); }
        .week-day-col.selected .wd-name { color: var(--text-main); font-weight: 700; }
        .week-day-col.selected .wd-circle { border: 2px solid #111; transform: scale(1.1); }

        .routine-dashboard { background: #1a1a1a; color: white; border-radius: 24px; padding: 30px 20px; margin-bottom: 30px; text-align: center; position: relative; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .routine-progress-outer { width: 120px; height: 120px; margin: 0 auto 15px; border-radius: 50%; background: conic-gradient(var(--primary-lime) 75%, #333 0); display: flex; align-items: center; justify-content: center; position: relative; }
        .routine-progress-inner { width: 100px; height: 100px; background: #1a1a1a; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: absolute; }
        .emoji-center { font-size: 40px; z-index: 2; }
        
        .routine-list-item { background: white; padding: 15px 20px; border-radius: 18px; display: flex; align-items: center; margin-bottom: 12px; box-shadow: var(--card-shadow); }
        .routine-icon { width: 44px; height: 44px; background: #F0F2F5; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 20px; margin-right: 15px; }
        .routine-info { flex: 1; }
        .routine-name { font-size: 15px; font-weight: 600; margin-bottom: 2px; }
        .routine-time { font-size: 12px; color: #888; }
        .play-btn { width: 34px; height: 34px; border-radius: 50%; background: #f0f0f0; color: #ccc; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; }
        .play-btn.playing { background: var(--primary-lime); color: var(--text-main); }

        /* [SCORE Styles] */
        .score-hero-dark { background: #222; border-radius: 28px; padding: 30px 25px; color: white; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 15px 40px rgba(0,0,0,0.2); position: relative; overflow: hidden; margin-bottom: 25px; }
        .score-hero-dark::after { content: ''; position: absolute; top: -50%; right: -20%; width: 200px; height: 200px; background: radial-gradient(circle, rgba(208, 255, 70, 0.15) 0%, rgba(0,0,0,0) 70%); border-radius: 50%; pointer-events: none; }
        .score-hero-left h2 { font-size: 14px; color: #aaa; margin-bottom: 8px; font-weight: 500; }
        .score-hero-left .big-score { font-size: 56px; font-weight: 800; line-height: 1; color: var(--white); display: flex; align-items: baseline; gap: 5px; }
        .score-hero-left .big-score span { font-size: 20px; color: var(--primary-lime); }
        .score-hero-left .score-change { display: inline-flex; align-items: center; gap: 5px; background: rgba(255,255,255,0.1); padding: 6px 12px; border-radius: 20px; font-size: 12px; margin-top: 15px; color: var(--primary-lime); }

        .score-gauge-box { position: relative; width: 100px; height: 100px; }
        .score-gauge-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .gauge-bg { fill: none; stroke: #444; stroke-width: 8; }
        .gauge-fill { fill: none; stroke: var(--primary-lime); stroke-width: 8; stroke-linecap: round; stroke-dasharray: 251; stroke-dashoffset: 251; animation: fillGauge 1.2s ease-out forwards 0.3s; }
        @keyframes fillGauge { to { stroke-dashoffset: 90; } }

        .score-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 25px; }
        .stat-card { background: white; padding: 16px; border-radius: 20px; box-shadow: var(--card-shadow); }
        .stat-icon { width: 36px; height: 36px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 12px; font-size: 18px; }
        .stat-name { font-size: 13px; color: #888; margin-bottom: 6px; }
        .stat-val-row { display: flex; justify-content: space-between; align-items: flex-end; }
        .stat-val { font-size: 18px; font-weight: 700; color: #333; }
        .stat-bar-bg { width: 100%; height: 6px; background: #f0f0f0; border-radius: 3px; margin-top: 10px; overflow: hidden; }
        .stat-bar-fill { height: 100%; border-radius: 3px; width: 0; transition: width 1s ease-out; }

        .trend-box { background: white; padding: 20px; border-radius: 24px; box-shadow: var(--card-shadow); margin-bottom: 25px; }
        .box-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .graph-area { display: flex; justify-content: space-between; align-items: flex-end; height: 100px; padding: 0 5px; }
        .graph-col { display: flex; flex-direction: column; align-items: center; gap: 8px; width: 30px; }
        .bar-bg { width: 12px; height: 80px; background: #f5f5f5; border-radius: 6px; display: flex; align-items: flex-end; overflow: hidden; }
        .bar-fill { width: 100%; background: var(--primary-lime); border-radius: 6px; height: 0; animation: growBar 0.8s ease-out forwards; }
        .day-label { font-size: 11px; color: #aaa; font-weight: 500; }
        @keyframes growBar { to { height: var(--h); } }

        .ai-box-new { background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); padding: 20px; border-radius: 24px; display: flex; gap: 15px; align-items: flex-start; box-shadow: 0 4px 15px rgba(46, 125, 50, 0.1); }
        .ai-icon-new { width: 40px; height: 40px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #2E7D32; flex-shrink: 0; }
        .ai-text-new { font-size: 14px; color: #1B5E20; line-height: 1.5; }

        /* [MY PAGE Styles] */
        .profile-header { display: flex; align-items: center; padding: 10px 0 30px; }
        .profile-img { width: 64px; height: 64px; background: #ddd; border-radius: 50%; margin-right: 15px; background-image: url('https://api.dicebear.com/7.x/avataaars/svg?seed=Felix'); background-size: cover; border: 3px solid var(--white); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        /* Main Menu & Sub-Pages Views */
        .menu-list { background: var(--white); border-radius: 24px; padding: 10px 20px; box-shadow: var(--card-shadow); margin-bottom: 20px; }
        .menu-item { display: flex; justify-content: space-between; align-items: center; padding: 18px 0; border-bottom: 1px solid #f0f0f0; cursor: pointer; }
        .menu-left { display: flex; align-items: center; gap: 12px; font-size: 15px; font-weight: 500; }
        .menu-icon-box { width: 32px; height: 32px; background: #f9f9f9; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #555; }

        /* Sub-pages container */
        .my-sub-page { display: none; animation: fadeIn 0.2s; }
        .my-sub-page.active { display: block; }
        .sub-page-title { font-size: 18px; font-weight: 700; margin-bottom: 20px; }
        
        /* Back Button in Header */
        .header-back-btn { display: none; cursor: pointer; margin-right: 10px; }
        
        /* Form Elements for Sub-pages */
        .setting-group { margin-bottom: 25px; }
        .setting-label { font-size: 13px; color: #888; margin-bottom: 8px; display: block; }
        .setting-input { width: 100%; padding: 15px; background: #f5f5f5; border: none; border-radius: 14px; font-size: 15px; outline: none; }
        .setting-btn { width: 100%; padding: 15px; background: var(--text-main); color: white; border: none; border-radius: 14px; font-weight: 700; cursor: pointer; margin-top: 10px; }
        .setting-btn.danger { background: #ffebee; color: var(--danger); }
        
        /* Toggle Switch */
        .toggle-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0; }
        .toggle-switch { position: relative; width: 44px; height: 24px; }
        .toggle-input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .toggle-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
        .toggle-input:checked + .toggle-slider { background-color: var(--primary-lime); }
        .toggle-input:checked + .toggle-slider:before { transform: translateX(20px); }

        /* Navigation */
        nav { height: 90px; background: var(--white); display: flex; justify-content: space-around; padding-top: 12px; border-top: 1px solid #eee; border-radius: 30px 30px 0 0; position: absolute; bottom: 0; width: 100%; z-index: 100; box-shadow: 0 -5px 20px rgba(0,0,0,0.02); }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 5px; cursor: pointer; width: 20%; }
        .nav-text { font-size: 10px; color: #ccc; font-weight: 600; transition: color 0.2s; }
        .nav-item.active .icon-svg { stroke: var(--text-main); fill: var(--primary-lime); stroke-width: 1.5; }
        .nav-item.active .nav-text { color: var(--text-main); }
        .nav-item:not(.active) .icon-svg { stroke: #ccc; }

    </style>
</head>
<body>

    <div class="mobile-frame">
        
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
        <div class="sidebar" id="notificationSidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">ì•Œë¦¼ ì„¼í„°</div>
                <div class="close-btn" onclick="toggleSidebar()">âœ•</div>
            </div>
            <div class="noti-item">
                <div class="noti-icon-box" style="color:var(--primary-lime); background:#111;">ğŸ†</div>
                <div><h4>ì ìˆ˜ ìƒìŠ¹!</h4><p>ì–´ì œë³´ë‹¤ ì ìˆ˜ê°€ 3ì  ì˜¬ëìŠµë‹ˆë‹¤.</p></div>
            </div>
            <div class="noti-item">
                <div class="noti-icon-box" style="color:#2196F3;">ğŸ’§</div>
                <div><h4>ë¬¼ ë§ˆì‹œê¸°</h4><p>ìˆ˜ë¶„ ì„­ì·¨ ì‹œê°„ì…ë‹ˆë‹¤.</p></div>
            </div>
        </div>

        <div id="confirmModal" class="modal-overlay">
            <div class="modal-box">
                <div class="modal-title">ì§€ê¸ˆ ì‹¤ì²œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
                <div class="modal-desc">ì˜¤ëŠ˜ì˜ ì‹¤ì²œ ê¸°ë¡ì— ì¶”ê°€ë©ë‹ˆë‹¤.</div>
                <div class="modal-btns">
                    <button class="modal-btn btn-cancel" onclick="closeModals()">ì·¨ì†Œ</button>
                    <button class="modal-btn btn-confirm" onclick="processAction()">ì‹¤ì²œ</button>
                </div>
            </div>
        </div>
        
        <div id="successModal" class="modal-overlay">
            <div class="modal-box">
                <div class="checkmark-circle"><span class="checkmark">âœ”</span></div>
                <div class="modal-title">ì‹¤ì²œ ì™„ë£Œ!</div>
                <div class="modal-desc">ë©‹ì§„ ì‹œì‘ì…ë‹ˆë‹¤!<br>ì ìˆ˜ê°€ ì ë¦½ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
            </div>
        </div>

        <div class="status-bar">
            <span>11:55</span>
            <span>LTE</span>
        </div>

        <div id="home" class="content-area tab-content active">
            <div class="header-row">
                <div class="logo-container">
                    <div class="deco-blob blob-1"></div>
                    <div class="blob-line"></div>
                    <h1 class="page-title">Moa Now</h1>
                </div>
                <div class="noti-btn" onclick="toggleSidebar()">
                    <div class="noti-dot"></div>
                    <svg class="icon-svg" style="color:#333;" viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                </div>
            </div>

            <div class="home-score-card" onclick="switchTab('score', document.getElementById('nav-score'))">
                <div class="home-score-text">
                    <h3>ì˜¤ëŠ˜ì˜ ë¼ì´í”„ ì ìˆ˜</h3>
                    <div class="value">64<span style="font-size:18px; font-weight:600;">ì </span></div>
                    <div class="score-trend">
                        <svg class="icon-svg icon-sm" viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                        ìƒìŠ¹ì¤‘
                    </div>
                </div>
                <div class="home-chart-container">
                    <svg viewBox="0 0 80 80" class="home-circular-chart">
                        <path class="home-circle-bg" d="M40 4 a 36 36 0 0 1 0 72 a 36 36 0 0 1 0 -72" />
                        <path class="home-circle" d="M40 4 a 36 36 0 0 1 0 72 a 36 36 0 0 1 0 -72" />
                    </svg>
                    <svg class="icon-svg chart-icon" viewBox="0 0 24 24" style="position:absolute; color:var(--primary-lime);"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 1 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg>
                </div>
            </div>

            <div class="now-card">
                <div class="now-badge">NOW FEED</div>
                <div class="now-title">ì ì‹¬ ì‹ì‚¬ í›„,<br><span style="color:var(--primary-lime)">ê°€ë²¼ìš´ ì‚°ì±…</span> ì–´ë•Œìš”? ğŸƒâ€â™‚ï¸</div>
                <button class="action-btn" onclick="openConfirmModal()">ì§€ê¸ˆ ì‹¤ì²œí•˜ê¸°</button>
            </div>

            <div class="section-title">ì˜¤ëŠ˜ì˜ ì¼ì • (Today)</div>
            <div id="homeScheduleList"></div>
        </div>

        <div id="todo" class="content-area tab-content">
            <div class="header-row"><div class="logo-container"><div class="blob-line"></div><h1 class="page-title">Schedule</h1></div></div>
            
            <div class="calendar-container">
                <div class="cal-header">
                    <div class="cal-nav-btn" onclick="changeMonth(-1)">â€¹</div>
                    <div class="cal-title" id="calTitle">2025ë…„ 11ì›”</div>
                    <div class="cal-nav-btn" onclick="changeMonth(1)">â€º</div>
                </div>
                <div class="cal-grid">
                    <div class="cal-day-name" style="color:#ff5252">ì¼</div><div class="cal-day-name">ì›”</div><div class="cal-day-name">í™”</div><div class="cal-day-name">ìˆ˜</div><div class="cal-day-name">ëª©</div><div class="cal-day-name">ê¸ˆ</div><div class="cal-day-name">í† </div>
                </div>
                <div class="cal-grid" id="calendarBody"></div>
            </div>

            <div class="date-display-header" id="selectedDateDisplay">11ì›” 24ì¼ í™”ìš”ì¼</div>
            
            <div class="add-box">
                <input type="time" id="timeInput" class="add-time-input">
                <input type="text" id="todoInput" class="add-text-input" placeholder="ì¼ì • ì´ë¦„" onkeypress="if(event.key === 'Enter') addTodo()">
                <button class="add-btn" onclick="addTodo()">+</button>
            </div>
            
            <div id="todoPageList"></div>
        </div>

        <div id="routine" class="content-area tab-content">
            <div class="header-row"><div class="logo-container"><div class="blob-line"></div><h1 class="page-title">My Routine</h1></div></div>
            
            <div class="routine-week-tracker">
                <div class="week-day-col" onclick="selectRoutineDay(this, 0)"><div class="wd-name">ì›”</div><div class="wd-circle filled">24</div></div>
                <div class="week-day-col" onclick="selectRoutineDay(this, 1)"><div class="wd-name">í™”</div><div class="wd-circle filled">25</div></div>
                <div class="week-day-col" onclick="selectRoutineDay(this, 2)"><div class="wd-name">ìˆ˜</div><div class="wd-circle filled">26</div></div>
                <div class="week-day-col" onclick="selectRoutineDay(this, 3)"><div class="wd-name">ëª©</div><div class="wd-circle filled">27</div></div>
                <div class="week-day-col" onclick="selectRoutineDay(this, 4)"><div class="wd-name">ê¸ˆ</div><div class="wd-circle">28</div></div>
                <div class="week-day-col" onclick="selectRoutineDay(this, 5)"><div class="wd-name">í† </div><div class="wd-circle">29</div></div>
                <div class="week-day-col" onclick="selectRoutineDay(this, 6)"><div class="wd-name">ì¼</div><div class="wd-circle">30</div></div>
            </div>

            <div class="routine-dashboard">
                <div class="routine-progress-outer"><div class="routine-progress-inner"><div class="emoji-center">ğŸ”¥</div></div></div>
                <div style="font-size:14px; color:#aaa; margin-bottom:5px;">ì˜¤ëŠ˜ì˜ ë‹¬ì„±ë¥ </div>
                <div style="font-size:24px; font-weight:800; color:var(--primary-lime);">75%</div>
            </div>

            <div class="section-title"><span>â˜€ï¸</span> Morning Routine</div>
            <div class="routine-list-item">
                <div class="routine-icon">ğŸ›ï¸</div>
                <div class="routine-info"><div class="routine-name">ì´ë¶ˆ ì •ë¦¬í•˜ê¸°</div><div class="routine-time">ê¸°ìƒ ì§í›„</div></div>
                <div class="play-btn" onclick="togglePlay(this)">â–¶</div>
            </div>
             <div class="routine-list-item">
                <div class="routine-icon">ğŸ¥—</div>
                <div class="routine-info"><div class="routine-name">ì˜ì–‘ì œ ì„­ì·¨</div><div class="routine-time">08:00 AM</div></div>
                <div class="play-btn" onclick="togglePlay(this)">â–¶</div>
            </div>
            <div class="section-title"><span>ğŸŒ™</span> Night Routine</div>
            <div class="routine-list-item">
                <div class="routine-icon">ğŸ“–</div>
                <div class="routine-info"><div class="routine-name">ë…ì„œ 10ë¶„</div><div class="routine-time">ìê¸° ì „</div></div>
                <div class="play-btn" onclick="togglePlay(this)">â–¶</div>
            </div>
        </div>

        <div id="score" class="content-area tab-content">
            <div class="header-row"><div class="logo-container"><div class="blob-line"></div><h1 class="page-title">My Score</h1></div></div>
            <div class="score-hero-dark">
                <div class="score-hero-left">
                    <h2>ì¢…í•© ë°¸ëŸ°ìŠ¤ ì ìˆ˜</h2>
                    <div class="big-score">64<span>ì </span></div>
                    <div class="score-change">ì–´ì œë³´ë‹¤ 3ì  ìƒìŠ¹</div>
                </div>
                <div class="score-gauge-box">
                    <svg class="score-gauge-svg" viewBox="0 0 100 100">
                        <circle class="gauge-bg" cx="50" cy="50" r="40"></circle>
                        <circle class="gauge-fill" cx="50" cy="50" r="40"></circle>
                    </svg>
                </div>
            </div>
            <div class="score-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background:#e3f2fd; color:var(--color-sleep);">ğŸ˜´</div>
                    <div class="stat-name">ìˆ˜ë©´ Quality</div>
                    <div class="stat-val-row"><div class="stat-val">72ì </div></div>
                    <div class="stat-bar-bg"><div class="stat-bar-fill" style="width:72%; background:var(--color-sleep);"></div></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:#fff3e0; color:var(--color-focus);">ğŸ”¥</div>
                    <div class="stat-name">ì§‘ì¤‘ë„</div>
                    <div class="stat-val-row"><div class="stat-val">85ì </div></div>
                    <div class="stat-bar-bg"><div class="stat-bar-fill" style="width:85%; background:var(--color-focus);"></div></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:#f3e5f5; color:var(--color-routine);">ğŸ“…</div>
                    <div class="stat-name">ë£¨í‹´ ë‹¬ì„±</div>
                    <div class="stat-val-row"><div class="stat-val">55ì </div></div>
                    <div class="stat-bar-bg"><div class="stat-bar-fill" style="width:55%; background:var(--color-routine);"></div></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:#e8f5e9; color:var(--color-detox);">ğŸ“±</div>
                    <div class="stat-name">ë””ì§€í„¸ ë””í†¡ìŠ¤</div>
                    <div class="stat-val-row"><div class="stat-val">40ì </div></div>
                    <div class="stat-bar-bg"><div class="stat-bar-fill" style="width:40%; background:var(--color-detox);"></div></div>
                </div>
            </div>
            <div class="trend-box">
                <div class="box-header"><div class="box-title">ì£¼ê°„ íŠ¸ë Œë“œ</div></div>
                <div class="graph-area">
                    <div class="graph-col"><div class="bar-bg"><div class="bar-fill" style="--h:40%;"></div></div><div class="day-label">ì›”</div></div>
                    <div class="graph-col"><div class="bar-bg"><div class="bar-fill" style="--h:55%; background:var(--text-main);"></div></div><div class="day-label" style="color:var(--text-main); font-weight:700;">í™”</div></div>
                    <div class="graph-col"><div class="bar-bg"><div class="bar-fill" style="--h:64%;"></div></div><div class="day-label">ìˆ˜</div></div>
                    <div class="graph-col"><div class="bar-bg"><div class="bar-fill" style="--h:50%;"></div></div><div class="day-label">ëª©</div></div>
                    <div class="graph-col"><div class="bar-bg"><div class="bar-fill" style="--h:70%;"></div></div><div class="day-label">ê¸ˆ</div></div>
                    <div class="graph-col"><div class="bar-bg"><div class="bar-fill" style="--h:85%;"></div></div><div class="day-label">í† </div></div>
                    <div class="graph-col"><div class="bar-bg"><div class="bar-fill" style="--h:60%;"></div></div><div class="day-label">ì¼</div></div>
                </div>
            </div>
            <div class="ai-box-new">
                <div class="ai-icon-new"><svg class="icon-svg" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg></div>
                <div class="ai-text-new">"ìˆ˜ë©´ ì ìˆ˜ê°€ ë‚®ì•„ <strong>ë””ì§€í„¸ ë””í†¡ìŠ¤</strong> ì ìˆ˜ì—ë„ ì˜í–¥ì„ ì£¼ê³  ìˆì–´ìš”. ì˜¤ëŠ˜ì€ SNS ì‚¬ìš©ì„ 30ë¶„ ì¤„ì—¬ë³´ì„¸ìš”."</div>
            </div>
        </div>

        <div id="my" class="content-area tab-content">
            <div class="header-row">
                <div class="logo-container" style="display:flex; align-items:center;">
                    <span class="header-back-btn" id="myBackBtn" onclick="closeSubPage()">
                        <svg class="icon-svg" viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"></polyline></svg>
                    </span>
                    <h1 class="page-title" id="myPageTitle">My Page</h1>
                </div>
            </div>

            <div id="my-main-view">
                <div class="profile-header">
                    <div class="profile-img"></div>
                    <div class="profile-info"><h2>ì‚¬ìš©ì</h2><p style="font-size:13px; color:#777;">moa-user@example.com</p></div>
                </div>
                <div class="menu-list">
                    <div class="menu-item" onclick="openSubPage('profile-edit', 'í”„ë¡œí•„ ìˆ˜ì •')">
                        <div class="menu-left">
                            <div class="menu-icon-box"><svg class="icon-svg icon-sm" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></div>
                            í”„ë¡œí•„ ìˆ˜ì •
                        </div>
                        <svg class="icon-svg icon-sm" style="color:#ccc;" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
                    </div>
                    <div class="menu-item" onclick="openSubPage('noti-settings', 'ì•Œë¦¼ ì„¤ì •')">
                        <div class="menu-left">
                            <div class="menu-icon-box"><svg class="icon-svg icon-sm" viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg></div>
                            ì•Œë¦¼ ì„¤ì •
                        </div>
                        <svg class="icon-svg icon-sm" style="color:#ccc;" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
                    </div>
                    <div class="menu-item" onclick="openSubPage('security', 'ê³„ì • ë° ë³´ì•ˆ')">
                        <div class="menu-left">
                            <div class="menu-icon-box"><svg class="icon-svg icon-sm" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></div>
                            ê³„ì • ë° ë³´ì•ˆ
                        </div>
                        <svg class="icon-svg icon-sm" style="color:#ccc;" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
                    </div>
                    <div class="menu-item" onclick="openSubPage('theme', 'í…Œë§ˆ ì„¤ì •')">
                        <div class="menu-left">
                            <div class="menu-icon-box"><svg class="icon-svg icon-sm" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg></div>
                            í…Œë§ˆ ì„¤ì •
                        </div>
                        <svg class="icon-svg icon-sm" style="color:#ccc;" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
                    </div>
                </div>
                <div class="menu-list">
                    <div class="menu-item" onclick="openSubPage('app-info', 'ì•± ì •ë³´')">
                        <div class="menu-left">
                            <div class="menu-icon-box"><svg class="icon-svg icon-sm" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></div>
                            ì•± ì •ë³´
                        </div>
                        <svg class="icon-svg icon-sm" style="color:#ccc;" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
                    </div>
                    <div class="menu-item">
                        <div class="menu-left" style="color:#FF5252;">
                            <div class="menu-icon-box" style="background:#ffebee; color:#FF5252;"><svg class="icon-svg icon-sm" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg></div>
                            ë¡œê·¸ì•„ì›ƒ
                        </div>
                    </div>
                </div>
            </div>

            <div id="my-sub-view" style="display:none;">
                <div id="profile-edit" class="my-sub-page">
                    <div style="text-align:center; margin-bottom:30px;">
                        <div class="profile-img" style="width:100px; height:100px; margin:0 auto 15px;"></div>
                        <div style="color:var(--primary-lime-dark); font-weight:600; font-size:14px;">ì‚¬ì§„ ë³€ê²½</div>
                    </div>
                    <div class="setting-group">
                        <label class="setting-label">ì´ë¦„</label>
                        <input type="text" class="setting-input" value="ì‚¬ìš©ì">
                    </div>
                    <div class="setting-group">
                        <label class="setting-label">ìƒíƒœ ë©”ì‹œì§€</label>
                        <input type="text" class="setting-input" value="ì˜¤ëŠ˜ë„ í™”ì´íŒ…! ğŸ’ª">
                    </div>
                    <button class="setting-btn" onclick="closeSubPage()">ì €ì¥í•˜ê¸°</button>
                </div>

                <div id="noti-settings" class="my-sub-page">
                    <div class="menu-list">
                        <div class="toggle-row" style="padding:15px 20px;">
                            <span>ì „ì²´ ì•Œë¦¼</span>
                            <label class="toggle-switch"><input type="checkbox" class="toggle-input" checked><span class="toggle-slider"></span></label>
                        </div>
                        <div class="toggle-row" style="padding:15px 20px;">
                            <span>ë£¨í‹´ ì•Œë¦¼</span>
                            <label class="toggle-switch"><input type="checkbox" class="toggle-input" checked><span class="toggle-slider"></span></label>
                        </div>
                        <div class="toggle-row" style="padding:15px 20px; border:none;">
                            <span>ì†Œë¦¬ ë° ì§„ë™</span>
                            <label class="toggle-switch"><input type="checkbox" class="toggle-input" checked><span class="toggle-slider"></span></label>
                        </div>
                    </div>
                </div>

                <div id="security" class="my-sub-page">
                    <div class="menu-list">
                        <div class="menu-item" style="padding:15px 20px;"><div>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div></div>
                        <div class="menu-item" style="padding:15px 20px; border:none;"><div>2ë‹¨ê³„ ì¸ì¦ ì„¤ì •</div></div>
                    </div>
                    <button class="setting-btn danger">íšŒì› íƒˆí‡´</button>
                </div>

                <div id="theme" class="my-sub-page">
                    <div class="menu-list">
                        <div class="toggle-row" style="padding:15px 20px;">
                            <span>ë‹¤í¬ ëª¨ë“œ</span>
                            <label class="toggle-switch"><input type="checkbox" class="toggle-input"><span class="toggle-slider"></span></label>
                        </div>
                    </div>
                    <div style="font-size:14px; color:#888; margin-bottom:10px;">ê°•ì¡° ì»¬ëŸ¬</div>
                    <div style="display:flex; gap:10px;">
                        <div style="width:40px; height:40px; background:#D0FF46; border-radius:50%; border:3px solid #333;"></div>
                        <div style="width:40px; height:40px; background:#FF5252; border-radius:50%;"></div>
                        <div style="width:40px; height:40px; background:#4e8cff; border-radius:50%;"></div>
                    </div>
                </div>

                <div id="app-info" class="my-sub-page">
                    <div class="menu-list" style="text-align:center; padding:30px;">
                        <div class="logo-container" style="margin-bottom:10px;"><h1 style="font-size:24px;">Moa Now</h1></div>
                        <div style="color:#888; margin-bottom:20px;">Version 1.0.0</div>
                        <div style="border-top:1px solid #eee; padding-top:20px; text-align:left;">
                            <div style="padding:10px 0;">ì´ìš©ì•½ê´€</div>
                            <div style="padding:10px 0;">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</div>
                            <div style="padding:10px 0;">ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ì„ ìŠ¤</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <nav>
            <div class="nav-item active" onclick="switchTab('home', this)">
                <svg class="icon-svg" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                <span class="nav-text">í™ˆ</span>
            </div>
            <div class="nav-item" onclick="switchTab('todo', this)">
                <svg class="icon-svg" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                <span class="nav-text">í•  ì¼</span>
            </div>
            <div class="nav-item" onclick="switchTab('routine', this)">
                <svg class="icon-svg" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                <span class="nav-text">ë£¨í‹´</span>
            </div>
            <div class="nav-item" id="nav-score" onclick="switchTab('score', this)">
                <svg class="icon-svg" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                <span class="nav-text">ìŠ¤ì½”ì–´</span>
            </div>
            <div class="nav-item" onclick="switchTab('my', this)">
                <svg class="icon-svg" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                <span class="nav-text">MY</span>
            </div>
        </nav>
    </div>

    <script>
        // Global State
        let today = new Date();
        let currentYear = today.getFullYear();
        let currentMonth = today.getMonth(); // 0-11
        let selectedDate = new Date(); // Defaults to today
        
        // Data Store
        let todoData = [
            { id: 1, date: getFormattedDate(new Date()), time: "09:00", apmp: "AM", text: "ì•Œê³ ë¦¬ì¦˜ ìˆ˜ì—…", tag: "í•™êµ", checked: true },
            { id: 2, date: getFormattedDate(new Date()), time: "13:00", apmp: "PM", text: "íŒ€ íšŒì˜", tag: "ë™ì•„ë¦¬", checked: false },
        ];

        // --- Helper Functions ---
        function getFormattedDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        function switchTab(tabId, navElement) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            if(navElement) navElement.classList.add('active');

            // [NEW] Routine Tab: Auto-select today
            if(tabId === 'routine') {
                initRoutineSelection();
            }
        }

        // --- My Page Sub-navigation ---
        function openSubPage(pageId, title) {
            document.getElementById('my-main-view').style.display = 'none';
            document.getElementById('my-sub-view').style.display = 'block';
            document.querySelectorAll('.my-sub-page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            document.getElementById('myPageTitle').innerText = title;
            document.getElementById('myBackBtn').style.display = 'block';
        }

        function closeSubPage() {
            document.getElementById('my-sub-view').style.display = 'none';
            document.getElementById('my-main-view').style.display = 'block';
            document.getElementById('myPageTitle').innerText = 'My Page';
            document.getElementById('myBackBtn').style.display = 'none';
        }

        function toggleSidebar() {
            document.getElementById('notificationSidebar').classList.toggle('active');
            document.querySelector('.sidebar-overlay').classList.toggle('active');
        }

        function toggleMicroItem(element) { element.classList.toggle('checked-state'); }
        function togglePlay(btn) { btn.innerText = btn.innerText === 'â–¶' ? 'â– ' : 'â–¶'; }

        // --- [NEW] Modal Logic ---
        function openConfirmModal() {
            document.getElementById('confirmModal').style.display = 'flex';
        }
        function closeModals() {
            document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none');
        }
        function processAction() {
            closeModals();
            const successModal = document.getElementById('successModal');
            successModal.style.display = 'flex';
            // Auto close after 2 seconds
            setTimeout(() => {
                successModal.style.display = 'none';
            }, 2000);
        }

        // --- Calendar Logic ---
        function renderCalendar(year, month) {
            const body = document.getElementById('calendarBody');
            const title = document.getElementById('calTitle');
            body.innerHTML = '';
            title.innerText = `${year}ë…„ ${month + 1}ì›”`;

            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();

            for(let i=0; i<firstDay; i++) body.innerHTML += `<div class="cal-date empty"></div>`;

            for(let d=1; d<=lastDate; d++) {
                const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const isSelected = dateStr === getFormattedDate(selectedDate);
                const isToday = dateStr === getFormattedDate(new Date());
                const hasTodo = todoData.some(t => t.date === dateStr);
                
                let classes = 'cal-date';
                if(isSelected) classes += ' selected';
                if(isToday) classes += ' today';
                if(hasTodo) classes += ' has-todo';

                const cell = document.createElement('div');
                cell.className = classes;
                cell.innerText = d;
                cell.onclick = () => selectDate(year, month, d);
                body.appendChild(cell);
            }
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if(currentMonth > 11) { currentMonth = 0; currentYear++; }
            if(currentMonth < 0) { currentMonth = 11; currentYear--; }
            renderCalendar(currentYear, currentMonth);
        }

        function selectDate(y, m, d) {
            selectedDate = new Date(y, m, d);
            renderCalendar(currentYear, currentMonth);
            updateDateHeader();
            renderTodos();
        }

        function updateDateHeader() {
            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const str = `${selectedDate.getMonth()+1}ì›” ${selectedDate.getDate()}ì¼ ${days[selectedDate.getDay()]}ìš”ì¼`;
            document.getElementById('selectedDateDisplay').innerText = str;
        }

        // --- To-Do Logic ---
        function renderTodos() {
            const homeList = document.getElementById('homeScheduleList');
            const todoPageList = document.getElementById('todoPageList');
            homeList.innerHTML = '';
            todoPageList.innerHTML = '';

            const selectedDateStr = getFormattedDate(selectedDate);
            const todayStr = getFormattedDate(new Date());

            const pageTasks = todoData.filter(t => t.date === selectedDateStr);
            pageTasks.forEach(item => {
                todoPageList.innerHTML += createTodoHTML(item, true);
            });

            const homeTasks = todoData.filter(t => t.date === todayStr);
            if(homeTasks.length === 0) homeList.innerHTML = '<div style="color:#aaa; font-size:13px; text-align:center; padding:10px;">ì˜¤ëŠ˜ì˜ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            homeTasks.forEach(item => {
                homeList.innerHTML += createTodoHTML(item, false);
            });
        }

        function createTodoHTML(item, showDelete) {
            const checkedClass = item.checked ? 'done' : '';
            const activeBorder = !item.checked ? 'active-border' : '';
            const checkIconOpacity = item.checked ? '1' : '0';
            const deleteHtml = showDelete ? `<div class="delete-btn-sm" onclick="deleteTodo(event, ${item.id})">ğŸ—‘</div>` : '';

            return `
                <div class="schedule-card ${checkedClass} ${activeBorder}" onclick="toggleTodo(${item.id})">
                    <div class="time-col">
                        ${item.time}
                        <span class="time-ampm">${item.apmp}</span>
                    </div>
                    <div class="task-col">
                        <div class="task-title">${item.text}</div>
                        <span class="task-tag">${item.tag}</span>
                    </div>
                    <div class="schedule-check-circle">
                        <svg class="icon-svg icon-sm" viewBox="0 0 24 24" style="opacity:${checkIconOpacity}; color:white;"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    </div>
                    ${deleteHtml}
                </div>
            `;
        }

        function addTodo() {
            const timeInput = document.getElementById('timeInput').value;
            const textInput = document.getElementById('todoInput').value.trim();
            
            if(textInput) {
                let displayTime = "12:00";
                let displayAmpm = "PM";
                
                if(timeInput) {
                    const [h, m] = timeInput.split(':');
                    let hour = parseInt(h);
                    displayAmpm = hour >= 12 ? 'PM' : 'AM';
                    hour = hour % 12 || 12;
                    displayTime = `${String(hour).padStart(2,'0')}:${m}`;
                }

                todoData.push({
                    id: Date.now(),
                    date: getFormattedDate(selectedDate),
                    time: displayTime, 
                    apmp: displayAmpm,
                    text: textInput, 
                    tag: "ì¼ì •", 
                    checked: false
                });
                
                document.getElementById('todoInput').value = '';
                renderTodos();
                renderCalendar(currentYear, currentMonth);
            }
        }

        function toggleTodo(id) {
            const item = todoData.find(i => i.id === id);
            if(item) { item.checked = !item.checked; renderTodos(); }
        }

        function deleteTodo(e, id) {
            e.stopPropagation();
            if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                todoData = todoData.filter(i => i.id !== id);
                renderTodos();
                renderCalendar(currentYear, currentMonth);
            }
        }

        // --- [NEW] Routine Auto-Selection ---
        function initRoutineSelection() {
            // 0(Sun) -> 6(Sun) in UI
            // 1(Mon) -> 0(Mon) in UI
            const dayIndex = new Date().getDay(); // Sun=0, Mon=1...
            let uiIndex = dayIndex - 1;
            if (uiIndex < 0) uiIndex = 6; // Handle Sunday

            // Select the element
            const cols = document.querySelectorAll('.week-day-col');
            cols.forEach(c => c.classList.remove('selected'));
            if(cols[uiIndex]) cols[uiIndex].classList.add('selected');
        }

        function selectRoutineDay(el, index) {
            document.querySelectorAll('.week-day-col').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
        }

        // Init
        renderCalendar(currentYear, currentMonth);
        renderTodos();
    </script>
</body>
</html>
